<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NYC Map</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
html, body {margin:0; padding:0; height:100%; width:100%; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;}
#map {height:100vh; width:100%;}
.version-box {
  position:absolute; top:10px; right:10px;
  background:white; padding:6px 12px; border-radius:10px;
  box-shadow:0 3px 10px rgba(0,0,0,0.15);
  font-weight:600; font-size:12px; z-index:1000;
}
#location-container {
  position:absolute; top:50px; right:10px; width:240px; max-height:80vh;
  background:white; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.15);
  display:flex; flex-direction:column; z-index:1000; font-size:14px;
}
#location-header {
  padding:10px; background:#f0f0f0; cursor:pointer;
  border-radius:12px 12px 0 0; font-weight:bold; border-bottom:1px solid #ccc;
}
#searchBox {display:none; margin:0 10px 5px 10px; padding:5px 7px;
  border-radius:5px; border:1px solid #ccc; font-size:12px;
  outline:none; background:white; width:calc(100% - 20px);
}
#locationList {overflow-y:auto; flex:1; padding:0; margin:0; display:none; border-top:1px solid #ccc;}
.category-title {font-weight:bold; padding:5px 10px; border-bottom:1px solid #ddd; background:#f9f9f9;}
.location-item {cursor:pointer; padding:5px 10px; border-bottom:1px solid #eee; transition: background 0.3s;}
.location-item:last-child {border-bottom:none;}
.location-item:hover {background-color:#eaeaea;}
#routeInfo {
  position:absolute; bottom:10px; left:50%; transform:translateX(-50%);
  background:white; padding:8px 12px; border-radius:10px;
  box-shadow:0 4px 12px rgba(0,0,0,0.15);
  font-size:12px; z-index:1000; max-width:90%;
  white-space:pre-line; overflow:hidden; text-overflow:ellipsis; line-height:1.4em;
}
@media (max-width:600px){
  #location-container{width:180px; top:60px;}
  #routeInfo{max-height:4.2em;} /* ~3 lines visible */
}
</style>
</head>
<body>
<div id="map"></div>
<div class="version-box" id="versionBox"></div>

<div id="location-container">
  <div id="location-header">Locations ▼</div>
  <input type="text" id="searchBox" placeholder="Search..." />
  <div id="locationList"></div>
</div>

<div id="routeInfo">Select a location to see walking distance and time</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-rotatedmarker/leaflet.rotatedMarker.js"></script>
<script>
// Version info
var mapDate = "23/10/25";
var mapVersion = 6.3;
document.getElementById("versionBox").innerText = "NYC Map " + mapDate + " (v" + mapVersion + ")";

// Default center before GPS
var currentLocation = [40.7851, -73.9683];

// Map setup
var map = L.map('map').setView(currentLocation, 14);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

// Icons
var icons = {
  hotel: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/red-dot.png', iconSize:[32,32]}),
  sight: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/green-dot.png', iconSize:[32,32]}),
  food: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/orange-dot.png', iconSize:[32,32]}),
  rooftop: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/purple-dot.png', iconSize:[32,32]}),
  subway: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/blue-dot.png', iconSize:[28,28]}),
};

// Locations
var locations = {
  "Locations": {
    "The Lexington Hotel":[40.7561,-73.9725,"hotel"],
    "Times Square":[40.7580,-73.9855,"sight"],
    "Central Park":[40.7851,-73.9683,"sight"],
    "Union Square":[40.7359,-73.9911,"sight"],
    "Bryant Park":[40.7536,-73.9832,"sight"],
    "Saks Fifth Avenue":[40.7603,-73.9756,"sight"],
    "Rockefeller Center":[40.7587,-73.9787,"sight"],
    "St. Patrick’s Cathedral":[40.7585,-73.9760,"sight"],
    "Plaza Hotel":[40.7644,-73.9747,"sight"],
    "Washington Square Fountain":[40.7308,-73.9973,"sight"],
    "Brooklyn Bridge by day":[40.7061,-73.9969,"sight"],
    "Brooklyn Bridge by night":[40.7061,-73.9969,"sight"],
    "Broadway":[40.7590,-73.9845,"sight"],
    "Empire State Building":[40.7484,-73.9857,"sight"],
    "Brooklyn riverside":[40.7003,-73.9967,"sight"],
    "Highline":[40.7480,-74.0048,"sight"],
    "Meatpacking":[40.7420,-74.0062,"sight"],
    "The Met":[40.7794,-73.9632,"sight"],
    "Wall Street – Bull & NYSE":[40.7075,-74.0113,"sight"],
    "Grand Central Station":[40.7527,-73.9772,"sight"],
    "Flat Iron Building":[40.7411,-73.9897,"sight"],
    "South Port":[40.7069,-74.0035,"sight"],
    "9/11 Memorial":[40.7115,-74.0134,"sight"],
    "Circle Line Dock":[40.7057,-74.0134,"sight"],
    "Soho":[40.7233,-74.0020,"sight"],
    "Little Italy":[40.7191,-73.9973,"sight"],
    "Hudson Yards":[40.7540,-74.0020,"sight"],
    "Chelsea Market":[40.7424,-74.0060,"sight"],
    "Renwick Triangle":[40.7303,-73.9866,"sight"],
    "The Edge":[40.7534,-74.0007,"sight"],
    "Statue of Liberty":[40.6892,-74.0445,"sight"]
  },
  "Rooftop Bars": {
    "Le Bain":[40.7416,-74.0072,"rooftop"],
    "The Public":[40.7278,-74.0020,"rooftop"],
    "Darling Rooftop Bar and Lounge":[40.7675,-73.9819,"rooftop"]
  },
  "Food & Drinks": {
    "Blue Bottle":[40.7410,-73.9887,"food"],
    "Tompkins Bagels":[40.7282,-73.9911,"food"],
    "Black Seed Bagels":[40.7230,-73.9973,"food"],
    "Chipotle":[40.7591,-73.9840,"food"],
    "Baby Luc's (Pizza)":[40.6761,-73.9981,"food"]
  },
  "Subway Stations": {
    "South Ferry":[40.701309,-74.013119,"subway"],
    "Bowling Green":[40.704288,-74.014027,"subway"],
    "Whitehall St":[40.703087,-74.012994,"subway"],
    "Rector St (1)":[40.707513,-74.013783,"subway"],
    "Rector St (R, W)":[40.70722,-74.0135,"subway"],
    "Wall St (2,3)":[40.707557,-74.011862,"subway"],
    "Wall St (4,5)":[40.706821,-74.0091,"subway"],
    "Fulton St":[40.710374,-74.007582,"subway"],
    "Chambers St":[40.714111,-74.009039,"subway"],
    "Cortlandt St":[40.710668,-74.011029,"subway"],
    "City Hall":[40.713282,-74.006978,"subway"],
    "Brooklyn Bridge–City Hall":[40.713065,-74.004131,"subway"],
    "Canal St":[40.719527,-74.006735,"subway"],
    "Houston St":[40.728226,-73.995623,"subway"]
  }
};
  // Add Upper Manhattan subways
var upperSubways = {
  "14th St":[40.737826,-74.000236,"subway"],
  "23rd St":[40.744081,-73.995657,"subway"],
  "34th St – Penn Station":[40.750373,-73.99339,"subway"],
  "34th St – Herald Sq":[40.749567,-73.98795,"subway"],
  "42nd St – Times Sq":[40.75529,-73.987495,"subway"],
  "47–50th St Rockefeller Ctr":[40.758663,-73.981329,"subway"],
  "59th St – Columbus Circle":[40.768044,-73.981893,"subway"],
  "66th St – Lincoln Center":[40.77344,-73.982209,"subway"],
  "72nd St":[40.778453,-73.98197,"subway"],
  "81st St – Museum of Natural History":[40.781433,-73.972143,"subway"],
  "86th St":[40.788644,-73.976218,"subway"],
  "96th St":[40.793919,-73.972323,"subway"],
  "103rd St":[40.799446,-73.968379,"subway"],
  "110th St – Cathedral Pkwy":[40.804056,-73.966911,"subway"],
  "116th St – Columbia University":[40.807722,-73.96411,"subway"],
  "125th St":[40.815581,-73.958372,"subway"]
};
for (let n in upperSubways) { locations["Subway Stations"][n] = upperSubways[n]; }

var markers = {};
for(let cat in locations){
  for(let key in locations[cat]){
    let loc = locations[cat][key];
    let m = L.marker([loc[0],loc[1]],{icon:icons[loc[2]]});
    m.bindPopup(key);
    m.on('click',()=>{ map.setView([loc[0],loc[1]],15); showDistance([loc[0],loc[1]],key); });
    markers[key]=m;
    if(cat!=="Subway Stations") m.addTo(map);
  }
}

// User location with direction arrow
var userMarker;
if(navigator.geolocation){
  navigator.geolocation.watchPosition(pos=>{
    var lat=pos.coords.latitude, lon=pos.coords.longitude;
    var acc=pos.coords.accuracy, dir=pos.coords.heading;
    currentLocation=[lat,lon];
    if(!userMarker){
      userMarker=L.marker([lat,lon],{
        icon:L.icon({iconUrl:"https://maps.google.com/mapfiles/ms/icons/blue-dot.png",iconSize:[28,28]}),
        rotationAngle:dir||0, rotationOrigin:"center"
      }).addTo(map).bindPopup("You are here");
    } else {
      userMarker.setLatLng([lat,lon]);
      if(dir) userMarker.setRotationAngle(dir);
    }
  });
}

// Distance/time
function showDistance(latlng,name){
  var R=6371e3, φ1=currentLocation[0]*Math.PI/180, φ2=latlng[0]*Math.PI/180;
  var Δφ=(latlng[0]-currentLocation[0])*Math.PI/180, Δλ=(latlng[1]-currentLocation[1])*Math.PI/180;
  var a=Math.sin(Δφ/2)**2+Math.cos(φ1)*Math.cos(φ2)*Math.sin(Δλ/2)**2;
  var c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)); var d=R*c;
  var walk=1.4; var t=Math.ceil(d/walk/60); var km=(d/1000).toFixed(2);
  document.getElementById("routeInfo").innerText=`${name}\nDistance: ${km} km\nWalk: ${t} min`;
}

// Subway checkbox
var subwayDiv=document.createElement("div");
subwayDiv.id="subwayToggleContainer";
subwayDiv.style.display="none";
subwayDiv.style.alignItems="center";
subwayDiv.style.padding="5px 10px";
var cb=document.createElement("input");
cb.type="checkbox"; cb.id="subwayCheckbox"; cb.style.marginRight="6px";
var lbl=document.createElement("label");
lbl.htmlFor="subwayCheckbox"; lbl.innerText="Show Subway Stations"; lbl.style.fontSize="12px";
subwayDiv.appendChild(cb); subwayDiv.appendChild(lbl);
document.getElementById("location-container").appendChild(subwayDiv);

// Build list
var list=document.getElementById("locationList");
for(let cat in locations){
  let title=document.createElement("div");
  title.className="category-title"; title.innerText=cat; list.appendChild(title);
  for(let k in locations[cat]){
    let div=document.createElement("div"); div.className="location-item"; div.innerText=k;
    div.onclick=()=>{markers[k].openPopup(); map.setView([locations[cat][k][0],locations[cat][k][1]],15); showDistance([locations[cat][k][0],locations[cat][k][1]],k);};
    if(cat==="Subway Stations") div.style.display="none";
    list.appendChild(div);
  }
}

// Checkbox toggle
cb.addEventListener("change",function(){
  let show=this.checked;
  for(let n in locations["Subway Stations"]){
    if(show) markers[n].addTo(map); else map.removeLayer(markers[n]);
  }
  let items=list.getElementsByClassName("location-item");
  for(let i=0;i<items.length;i++){
    let nm=items[i].innerText;
    if(locations["Subway Stations"][nm]) items[i].style.display=show?"":"none";
  }
});

// Collapsible list
var header=document.getElementById("location-header");
header.addEventListener("click",()=>{
  var l=document.getElementById("locationList");
  var s=document.getElementById("searchBox");
  if(l.style.display==="none"){l.style.display="block"; s.style.display="block"; subwayDiv.style.display="flex";}
  else{l.style.display="none"; s.style.display="none"; subwayDiv.style.display="none";}
});

// Search
document.getElementById("searchBox").addEventListener("input",function(){
  var f=this.value.toLowerCase();
  var items=document.getElementsByClassName("location-item");
  for(var i=0;i<items.length;i++){
    if(items[i].innerText.toLowerCase().includes(f)) items[i].style.display="";
    else items[i].style.display="none";
  }
});
</script>
</body>
</html>
