<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NYC Map v4.2</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
html, body {margin:0; padding:0; height:100%; width:100%; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;}
#map {height:100vh; width:100%;}
.version-box {
  position:absolute; top:10px; right:10px;
  background:white; padding:8px 14px; border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,0.15);
  font-weight:600; font-size:14px; z-index:1000;
}
#panel {
  position:absolute; top:60px; right:10px;
  width:250px; background:white; border-radius:10px;
  box-shadow:0 4px 12px rgba(0,0,0,0.15);
  overflow:hidden; z-index:1000; font-size:14px;
}
#panelHeader {
  background:#f0f0f0; padding:10px; font-weight:bold;
  cursor:pointer; border-bottom:1px solid #ccc; text-align:center;
}
#searchBox {
  display:none; width:calc(100% - 20px);
  margin:8px 10px; padding:6px 8px; border-radius:6px;
  border:1px solid #ccc; font-size:14px; background:white;
}
#listContainer {
  display:none; max-height:70vh; overflow-y:auto;
  border-top:1px solid #ccc;
}
.category {
  font-weight:bold; background:#fafafa; padding:6px 10px;
  border-bottom:1px solid #eee;
}
.item {
  padding:6px 10px; border-bottom:1px solid #f0f0f0;
  cursor:pointer; transition:background 0.2s;
}
.item:hover {background:#e9e9e9;}
#routeInfo {
  position:absolute; bottom:10px; left:50%; transform:translateX(-50%);
  background:white; padding:8px 14px; border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,0.15); font-size:14px; z-index:1000;
}
@media (max-width:600px){
  #panel{width:180px; font-size:13px;}
  .version-box{font-size:12px; padding:6px 10px;}
}
</style>
</head>
<body>
<div id="map"></div>
<div class="version-box">NYC map 20/11/2025 (v4.2)</div>

<div id="panel">
  <div id="panelHeader">Show Locations ▼</div>
  <input type="text" id="searchBox" placeholder="Search location...">
  <div id="listContainer"></div>
</div>

<div id="routeInfo">Select a location to see distance & walking time</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// ---- Map setup ----
var map = L.map('map').setView([40.7851, -73.9683], 13); // Central Park center
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

// ---- Icons ----
var icons = {
  hotel: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/red-dot.png', iconSize:[32,32]}),
  sight: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/green-dot.png', iconSize:[32,32]}),
  food: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/orange-dot.png', iconSize:[32,32]}),
  rooftop: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/purple-dot.png', iconSize:[32,32]}),
  subway: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/blue-dot.png', iconSize:[28,28]}),
  me: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/blue.png', iconSize:[24,24]})
};

// ---- Location data ----
var locations = {
  "Locations": {
    "The Lexington Hotel":[40.7561,-73.9725,"hotel"],
    "Times Square":[40.7580,-73.9855,"sight"],
    "Central Park – Bethesda Terrace":[40.7740,-73.9708,"sight"],
    "Central Park – Bow Bridge":[40.7762,-73.9690,"sight"],
    "Union Square":[40.7359,-73.9911,"sight"],
    "Bryant Park":[40.7536,-73.9832,"sight"],
    "Rockefeller Center":[40.7587,-73.9787,"sight"],
    "Empire State Building":[40.7484,-73.9857,"sight"],
    "Highline":[40.7480,-74.0048,"sight"],
    "Statue of Liberty":[40.6892,-74.0445,"sight"]
  },
  "Rooftop Bars": {
    "Le Bain":[40.7416,-74.0072,"rooftop"],
    "The Public":[40.7278,-74.0020,"rooftop"],
    "Darling Rooftop Bar and Lounge":[40.7675,-73.9819,"rooftop"]
  },
  "Food & Drinks": {
    "Blue Bottle":[40.7410,-73.9887,"food"],
    "Tompkins Bagels":[40.7282,-73.9911,"food"],
    "Black Seed Bagels":[40.7230,-73.9973,"food"],
    "Chipotle":[40.7591,-73.9840,"food"],
    "Baby Luc's (Pizza)":[40.6761,-73.9981,"food"]
  },
  "Subway Stations": {
    "South Ferry":[40.7013,-74.0132,"subway"],
    "Bowling Green":[40.7040,-74.0134,"subway"],
    "Fulton St":[40.7104,-74.0072,"subway"]
  }
};

// ---- Current location marker ----
var currentLoc = [40.7851, -73.9683];
L.marker(currentLoc, {icon: icons.me}).addTo(map).bindPopup("You are here");

// ---- Markers ----
var markers = {};
for (let category in locations){
  for (let name in locations[category]){
    let loc = locations[category][name];
    let marker = L.marker([loc[0],loc[1]],{icon:icons[loc[2]]}).addTo(map);
    marker.bindPopup(name);
    marker.on("click",()=>showDistance(name,[loc[0],loc[1]]));
    markers[name] = marker;
  }
}

// ---- Build collapsible list ----
var listContainer = document.getElementById("listContainer");
for (let cat in locations){
  let catDiv = document.createElement("div");
  catDiv.className="category";
  catDiv.textContent=cat;
  listContainer.appendChild(catDiv);
  for (let name in locations[cat]){
    let item = document.createElement("div");
    item.className="item";
    item.textContent=name;
    item.onclick=function(){
      map.setView(markers[name].getLatLng(),15);
      markers[name].openPopup();
      showDistance(name,[locations[cat][name][0],locations[cat][name][1]]);
    };
    listContainer.appendChild(item);
  }
}

// ---- Collapsible search ----
const panelHeader=document.getElementById("panelHeader");
const searchBox=document.getElementById("searchBox");
panelHeader.addEventListener("click",()=>{
  const open = listContainer.style.display==="block";
  listContainer.style.display=open?"none":"block";
  searchBox.style.display=open?"none":"block";
  panelHeader.innerText=open?"Show Locations ▼":"Hide Locations ▲";
});

// ---- Search ----
searchBox.addEventListener("input",()=>{
  let filter=searchBox.value.toLowerCase();
  document.querySelectorAll(".item").forEach(it=>{
    it.style.display=it.textContent.toLowerCase().includes(filter)?"block":"none";
  });
});

// ---- Distance/time ----
function showDistance(name,coords){
  let R=6371e3;
  let φ1=currentLoc[0]*Math.PI/180;
  let φ2=coords[0]*Math.PI/180;
  let Δφ=(coords[0]-currentLoc[0])*Math.PI/180;
  let Δλ=(coords[1]-currentLoc[1])*Math.PI/180;
  let a=Math.sin(Δφ/2)**2+Math.cos(φ1)*Math.cos(φ2)*Math.sin(Δλ/2)**2;
  let c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
  let d=R*c;
  let walkSpeed=1.4; // m/s
  let timeMin=Math.ceil(d/walkSpeed/60);
  let distKm=(d/1000).toFixed(2);
  document.getElementById("routeInfo").innerText=`${name}\nDistance: ${distKm} km\nEstimated walking time: ${timeMin} min`;
}
</script>
</body>
</html>
