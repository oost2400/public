<!DOCTYPE html>
<html>
<head>
    <title>NYC Interactive Map - Test Mode</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css"/>
    <style>
        html, body { height: 100%; margin: 0; }
        #map { height: 100%; width: 100%; }
        .version-box {
            position: absolute; top: 10px; right: 10px;
            background: white; padding: 8px 15px; border-radius: 6px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3); font-weight: bold; font-size: 16px; z-index: 1000;
        }
        #location-container {
            position: absolute; top: 50px; right: 10px;
            max-height: 70vh; width: 250px; overflow-y: auto;
            padding: 10px; border-radius: 6px; background-color: #f0f0f0;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3); font-size: 14px; z-index: 1000;
        }
        #searchBox {
            width: 100%; margin-bottom: 8px; padding: 5px;
            background-color: #f0f0f0; border: 1px solid #ccc; border-radius: 3px;
        }
        .location-item { cursor: pointer; padding: 2px 0; }
        .location-item:hover { background-color: #e0e0e0; }
        .leaflet-routing-container { display: none; }
    </style>
</head>
<body>
<div id="map"></div>
<div class="version-box" id="versionBox"></div>
<div id="location-container">
    <input type="text" id="searchBox" placeholder="Search location..."/>
    <div id="locationList"></div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
<script>
// --- Version info (edit here only)
var mapDate = "15 October 2025";
var mapVersion = 10;
document.getElementById("versionBox").innerText = "Map Version: " + mapDate + " (v" + mapVersion + ")";

// Create map
var map = L.map('map').setView([40.785091,-73.968285], 14);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap contributors' }).addTo(map);

// Icons
var icons = {
    hotel: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/red-dot.png', iconSize:[32,32]}),
    sight: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/green-dot.png', iconSize:[32,32]}),
    food: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/orange-dot.png', iconSize:[32,32]}),
    rooftop: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/purple-dot.png', iconSize:[32,32]}),
    subway: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/blue-dot.png', iconSize:[32,32]})
};

// All locations
var locations = {
    "The Lexington Hotel":[40.7561,-73.9725,"hotel"],
    "Times Square":[40.7580,-73.9855,"sight"],
    "Central Park":[40.7851,-73.9683,"sight"],
    "Union Square":[40.7359,-73.9911,"sight"],
    "Bryant Park":[40.7536,-73.9832,"sight"],
    "Saks Fifth Avenue":[40.7603,-73.9756,"sight"],
    "Rockefeller Center":[40.7587,-73.9787,"sight"],
    "St. Patrick’s Cathedral":[40.7585,-73.9760,"sight"],
    "Plaza Hotel":[40.7644,-73.9747,"sight"],
    "WSP":[40.7308,-73.9973,"sight"],
    "Brooklyn Bridge by day":[40.7061,-73.9969,"sight"],
    "Brooklyn Bridge by night":[40.7061,-73.9969,"sight"],
    "Broadway":[40.7590,-73.9845,"sight"],
    "Empire State Building":[40.7484,-73.9857,"sight"],
    "Brooklyn riverside":[40.7003,-73.9967,"sight"],
    "Highline":[40.7480,-74.0048,"sight"],
    "Meatpacking":[40.7420,-74.0062,"sight"],
    "The Met":[40.7794,-73.9632,"sight"],
    "Wall Street – Bull & NYSE":[40.7075,-74.0113,"sight"],
    "Grand Central Station":[40.7527,-73.9772,"sight"],
    "Flat Iron Building":[40.7411,-73.9897,"sight"],
    "South Port":[40.7069,-74.0035,"sight"],
    "9/11 Memorial":[40.7115,-74.0134,"sight"],
    "Circle Line Dock":[40.7057,-74.0134,"sight"],
    "Soho":[40.7233,-74.0020,"sight"],
    "Little Italy":[40.7191,-73.9973,"sight"],
    "Hudson Yards":[40.7540,-74.0020,"sight"],
    "Chelsea Market":[40.7424,-74.0060,"sight"],
    "Renwick Triangle":[40.7303,-73.9866,"sight"],
    "The Edge":[40.7534,-74.0007,"sight"],
    "Statue of Liberty":[40.6892,-74.0445,"sight"],
    "Blue Bottle":[40.7410,-73.9887,"food"],
    "Tompkins Bagels":[40.7282,-73.9911,"food"],
    "Black Seed Bagels":[40.7230,-73.9973,"food"],
    "Chipotle":[40.7591,-73.9840,"food"],
    "Baby Luc's (Pizza)":[40.6761,-73.9981,"food"],
    "Le Bain":[40.7416,-74.0072,"rooftop"],
    "The Public":[40.7278,-74.0020,"rooftop"],
    "South Ferry":[40.7013,-74.0132,"subway"],
    "Bowling Green":[40.7040,-74.0134,"subway"],
    "Fulton St":[40.7104,-74.0072,"subway"]
};

// Add markers
var markers = {};
for(var key in locations){
    var loc = locations[key];
    var marker = L.marker([loc[0],loc[1]],{icon: icons[loc[2]]}).bindPopup(key).addTo(map);
    markers[key] = marker;
}

// --- Simulated current location (Central Park center)
var currentMarker = L.circleMarker([40.785091,-73.968285],{
    radius: 10,
    color:'#007AFF',
    fillColor:'#007AFF',
    fillOpacity:0.9,
    weight:3
}).addTo(map).bindPopup("You are here (Simulated)").openPopup();

var accuracyCircle = L.circle([40.785091,-73.968285],{
    radius: 10,
    color:'#007AFF',
    fillOpacity:0.1
}).addTo(map);

var currentLatLng = [40.785091,-73.968285];

// Routing
var routingControl;
function showRouteTo(destLatLng){
    if(!currentLatLng){ alert("Current location not yet available"); return; }
    if(routingControl) map.removeControl(routingControl);
    routingControl = L.Routing.control({
        waypoints: [L.latLng(currentLatLng[0],currentLatLng[1]), L.latLng(destLatLng[0],destLatLng[1])],
        lineOptions: {styles:[{color:'blue',opacity:0.6,weight:4,dashArray:'10,10'}]},
        routeWhileDragging:false, addWaypoints:false, show:false, draggableWaypoints:false
    }).addTo(map);
}

// Location index
var locationList = document.getElementById("locationList");
for(var key in markers){
    var div = document.createElement("div");
    div.className="location-item";
    div.innerText=key;
    div.onclick = (function(k){
        return function(){
            map.setView(markers[k].getLatLng(),16);
            markers[k].openPopup();
            showRouteTo(markers[k].getLatLng());
        }
    })(key);
    locationList.appendChild(div);
}

// Search filter
document.getElementById("searchBox").addEventListener("input", function(){
    var filter = this.value.toLowerCase();
    var items = document.getElementsByClassName("location-item");
    for(var i=0;i<items.length;i++){
        items[i].style.display = (items[i].innerText.toLowerCase().indexOf(filter)>-1) ? "" : "none";
    }
});
</script>
</body>
</html>
