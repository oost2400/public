<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NYC Map v3.9</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
html, body {margin:0; padding:0; height:100%; width:100%; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;}
#map {height:100vh; width:100%;}
.version-box {
  position:absolute; top:10px; right:10px; background:white;
  padding:8px 14px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.15);
  font-weight:600; font-size:14px; z-index:1000;
}
#location-container {
  position:absolute; top:50px; right:10px; width:250px; max-height:80vh;
  background:white; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.15);
  display:flex; flex-direction:column; z-index:1000;
  font-size:14px;
}
#location-header {
  padding:10px; background:#f0f0f0; cursor:pointer;
  border-radius:12px 12px 0 0; font-weight:bold; border-bottom:1px solid #ccc;
}
#searchBox {
  display:none; margin:0 10px; padding:6px 8px; border-radius:5px;
  border:1px solid #ccc; font-size:14px; outline:none;
  background:white;
}
#locationList {
  overflow-y:auto; flex:1; padding:0; margin:0; display:none; border-top:1px solid #ccc;
}
.category-title {
  font-weight:bold; padding:6px 10px; border-bottom:1px solid #ddd; background:#f9f9f9;
}
.location-item {
  cursor:pointer; padding:6px 10px; border-bottom:1px solid #eee; transition: background 0.3s;
}
.location-item:last-child {border-bottom:none;}
.location-item:hover {background-color:#eaeaea;}
#routeInfo {
  position:absolute; bottom:10px; left:50%; transform:translateX(-50%);
  background:white; padding:10px 14px; border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,0.15); font-size:14px; z-index:1000; max-width:90%;
}
@media (max-width:600px){
  #location-container{width:95%; top:60px;}
  .version-box{ font-size:14px; padding:8px 14px;}
  #routeInfo{ font-size:14px; padding:8px 12px;}
  #searchBox{font-size:14px;}
}
</style>
</head>
<body>
<div id="map"></div>
<div class="version-box" id="versionBox"></div>

<div id="location-container">
  <div id="location-header">Locations ▼</div>
  <input type="text" id="searchBox" placeholder="Search..." />
  <div id="locationList"></div>
</div>

<div id="routeInfo">Select a location to see walking distance and time</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// Version info
var mapDate = "20 October 2025";
var mapVersion = 3.9;
document.getElementById("versionBox").innerText = "Map Version: " + mapDate + " (v" + mapVersion + ")";

// Current location (Central Park center for testing)
var currentLocation = [40.7851, -73.9683];

// Map
var map = L.map('map').setView(currentLocation, 14);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap contributors' }).addTo(map);

// Icons
var icons = {
  hotel: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/red-dot.png', iconSize:[32,32]}),
  sight: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/green-dot.png', iconSize:[32,32]}),
  food: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/orange-dot.png', iconSize:[32,32]}),
  rooftop: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/purple-dot.png', iconSize:[32,32]}),
  subway: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/blue-dot.png', iconSize:[28,28]}),
  me: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/blue.png', iconSize:[24,24]})
};

// Locations example
var locations = {
  "Locations": {
    "The Lexington Hotel":[40.7561,-73.9725,"hotel"],
    "Times Square":[40.7580,-73.9855,"sight"],
    "Central Park – Bethesda Terrace":[40.7740,-73.9708,"sight","Famous terrace & fountain"]
  },
  "Rooftop Bars": {
    "Le Bain":[40.7416,-74.0072,"rooftop"],
    "The Public":[40.7278,-74.0020,"rooftop"]
  },
  "Food & Drinks": {
    "Blue Bottle":[40.7410,-73.9887,"food"],
    "Tompkins Bagels":[40.7282,-73.9911,"food"]
  }
};

// Add markers
var markers = {};
for(let category in locations){
  for(let key in locations[category]){
    let loc = locations[category][key];
    let marker = L.marker([loc[0], loc[1]], {icon: icons[loc[2]]}).addTo(map);
    let popupText = key;
    if(loc[3]) popupText += "<br><small>" + loc[3] + "</small>";
    marker.bindPopup(popupText);
    marker.on('click', function(){showDistance([loc[0],loc[1]], key);});
    markers[key] = marker;
  }
}

// Current location marker
L.marker(currentLocation, {icon: icons.me}).addTo(map).bindPopup("You are here");

// Distance & time calculation
function showDistance(latlng,name){
  var R = 6371e3;
  var φ1 = currentLocation[0]*Math.PI/180;
  var φ2 = latlng[0]*Math.PI/180;
  var Δφ = (latlng[0]-currentLocation[0])*Math.PI/180;
  var Δλ = (latlng[1]-currentLocation[1])*Math.PI/180;
  var a = Math.sin(Δφ/2)**2 + Math.cos(φ1)*Math.cos(φ2)*Math.sin(Δλ/2)**2;
  var c = 2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
  var d = R*c; 
  var walkSpeed = 1.4; 
  var timeMin = Math.ceil(d / walkSpeed / 60);
  var distKm = (d/1000).toFixed(2);
  document.getElementById("routeInfo").innerText = `${name}\nDistance: ${distKm} km\nEstimated walking time: ${timeMin} min`;
}

// Build list
var locationList = document.getElementById("locationList");
for(let category in locations){
  let catTitle = document.createElement("div");
  catTitle.className="category-title";
  catTitle.innerText = category;
  locationList.appendChild(catTitle);
  for(let key in locations[category]){
    let loc = locations[category][key];
    let marker = markers[key];
    let div = document.createElement("div");
    div.className="location-item";
    div.innerText = key;
    div.onclick=function(){
      map.setView([loc[0],loc[1]],16);
      marker.openPopup();
      showDistance([loc[0],loc[1]], key);
    };
    locationList.appendChild(div);
  }
}

// Collapsible toggle
var header = document.getElementById("location-header");
header.addEventListener("click", function(){
  var list = document.getElementById("locationList");
  var search = document.getElementById("searchBox");
  if(list.style.display === "none"){
    list.style.display="block";
    search.style.display="block";
  } else {
    list.style.display="none";
    search.style.display="none";
  }
});

// Search filter
var searchBox = document.getElementById("searchBox");
searchBox.addEventListener("input", function(){
  var filter = this.value.toLowerCase();
  var items = document.getElementsByClassName("location-item");
  for(var i=0;i<items.length;i++){
    if(items[i].innerText.toLowerCase().indexOf(filter)>-1){
      items[i].style.display = "";
    } else {
      items[i].style.display = "none";
    }
  }
});
</script>
</body>
</html>
