<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>NYC Map</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
html,body{margin:0;padding:0;height:100%;width:100%;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;}
#map{height:100vh;width:100%;}

.version-box{
  position:absolute;
  top:10px;
  right:10px;
  background:white;
  padding:4px 8px;
  border-radius:10px;
  box-shadow:0 3px 10px rgba(0,0,0,0.15);
  font-weight:600;
  font-size:12px;
  z-index:1000;
}

#refreshLocation{
  position:absolute;
  top:40px; /* under version box */
  right:10px;
  background:#007bff;
  color:#fff;
  border:none;
  padding:4px 8px;
  border-radius:10px;
  cursor:pointer;
  box-shadow:0 3px 10px rgba(0,0,0,0.15);
  font-size:12px;
  z-index:1000;
}
#refreshLocation:hover{background:#0056b3;}

#location-container{
  position:absolute;
  top:70px;
  right:10px;
  width:200px;
  max-height:50vh; /* shorter list above route info */
  background:white;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,0.15);
  display:flex;
  flex-direction:column;
  z-index:1000;
  font-size:14px;
}

#location-header{
  padding:10px;
  background:#f0f0f0;
  cursor:pointer;
  border-radius:12px 12px 0 0;
  font-weight:bold;
  border-bottom:1px solid #ccc;
}

#searchBox{
  display:none;
  margin: 5px auto;
  padding:5px 7px;
  border-radius:5px;
  border:1px solid #ccc;
  font-size:12px;
  outline:none;
  background:white;
  width:calc(100% - 20px);
}

#locationList{
  overflow-y:auto;
  flex:1;
  padding:0;
  margin:0;
  display:none;
  border-top:1px solid #ccc;
}

.category-title{
  font-weight:bold;
  padding:5px 10px;
  border-bottom:1px solid #ddd;
  background:#f9f9f9;
}

.location-item{
  cursor:pointer;
  padding:5px 10px;
  border-bottom:1px solid #eee;
  transition:background 0.15s;
}
.location-item:last-child{border-bottom:none;}
.location-item:hover{background:#eaeaea;}

#routeInfo{
  position: absolute;
  bottom: 5px;
  left: 50%;
  transform: translateX(-50%);
  background: white;
  padding: 8px 12px;
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  font-size: 12px;
  z-index: 1000;
  max-width: 95%;
  line-height: 1.2em;
  max-height: 3.6em;
  overflow: hidden;
  white-space: pre-wrap;
  text-overflow: ellipsis;
}

@media (max-width:600px){
  #location-container{width:180px;top:60px;}
  #searchBox{width:calc(100% - 20px);}
  .version-box{font-size:11px;padding:3px 6px;}
  #refreshLocation{top:55px;right:10px;} /* under version box */
}
</style>
</head>
<body>

<div id="map"></div>
<div class="version-box" id="versionBox">NYC MAP 23/12/2025 v8.7</div>
<button id="refreshLocation">My Location</button>

<div id="location-container">
  <div id="location-header">Locations ▼</div>
  <input type="text" id="searchBox" placeholder="Search..." />
  <div id="locationList"></div>
</div>

<div id="routeInfo">Select a location to see walking distance and time</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// --- Map ---
var map = L.map('map').setView([40.7851,-73.9683],14);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap contributors' }).addTo(map);

// --- Icons ---
var icons = {
  hotel: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/red-dot.png', iconSize:[32,32]}),
  sight: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/green-dot.png', iconSize:[32,32]}),
  food: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/orange-dot.png', iconSize:[32,32]}),
  rooftop: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/purple-dot.png', iconSize:[32,32]}),
  subway: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/blue-dot.png', iconSize:[28,28]}),
  hidden: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/yellow-dot.png', iconSize:[32,32]})
};

// --- User location ---
var userMarker = L.circleMarker([0,0], {radius:8, color:'#007bff', fillColor:'#007bff', fillOpacity:1}).addTo(map);
var currentLatLng = [null,null];
var followUser=false;
var selectedLocation=null;
var currentLocationName="";
  // --- Locations ---
var locations = {
  "The Hotel": {"The Lexington Hotel":[40.7561,-73.9725,"hotel"]}, 
  "Locations": {
    "Times Square":[40.7580,-73.9855,"sight"],
    "Central Park":[40.7851,-73.9683,"sight"],
    "Central Park Boathouse":[40.7740,-73.9712,"sight"],
    "Central Park Zoo":[40.7679,-73.9718,"sight"],
    "Union Square":[40.7359,-73.9911,"sight"],
    "Bryant Park":[40.7536,-73.9832,"sight"],
    "Saks Fifth Avenue":[40.7603,-73.9756,"sight"],
    "Rockefeller Center":[40.7587,-73.9787,"sight"],
    "St. Patrick’s Cathedral":[40.7585,-73.9760,"sight"]
  },
  "Subway Stations": {
    "South Ferry":[40.701309,-74.013119,"subway"],
    "Bowling Green":[40.704288,-74.014027,"subway"]
  }
};

// --- Create markers and list ---
var markers={};
for(let cat in locations){
  for(let name in locations[cat]){
    let loc=locations[cat][name];
    let marker=L.marker([loc[0],loc[1]],{icon:icons[loc[2]]}).addTo(map);
    marker.bindPopup(name);
    marker.on('click',function(){
      currentLocationName=name;
      selectedLocation=[loc[0],loc[1]];
      map.panTo([loc[0],loc[1]]); // keep zoom manual
      showDistance(selectedLocation,name);
    });
    markers[name]=marker;
  }
}

// --- Distance calculation ---
function showDistance(latlng,name){
  if(!currentLatLng[0]) return;
  const R=6371e3;
  const φ1=currentLatLng[0]*Math.PI/180;
  const φ2=latlng[0]*Math.PI/180;
  const Δφ=(latlng[0]-currentLatLng[0])*Math.PI/180;
  const Δλ=(latlng[1]-currentLatLng[1])*Math.PI/180;
  const a=Math.sin(Δφ/2)**2 + Math.cos(φ1)*Math.cos(φ2)*Math.sin(Δλ/2)**2;
  const c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
  const d=R*c;
  const walkSpeed=1.4;
  const timeMin=Math.ceil(d/walkSpeed/60);
  const distKm=(d/1000).toFixed(2);
  document.getElementById("routeInfo").innerText=`${name}\nDistance: ${distKm} km\nEstimated walking time: ${timeMin} min`;
}

// --- Populate list ---
var locationList=document.getElementById("locationList");
for(let cat in locations){
  const title=document.createElement("div");
  title.className="category-title";
  title.innerText=cat;
  locationList.appendChild(title);
  for(let name in locations[cat]){
    const div=document.createElement("div");
    div.className="location-item";
    div.innerText=name;
    div.onclick=function(){
      markers[name].openPopup();
      selectedLocation=[locations[cat][name][0],locations[cat][name][1]];
      currentLocationName=name;
      map.panTo(selectedLocation);
      showDistance(selectedLocation,name);
      locationList.style.display="none";
      document.getElementById("searchBox").style.display="none";
    };
    locationList.appendChild(div);
  }
}

// --- Collapsible list ---
document.getElementById("location-header").addEventListener("click",function(){
  const list=document.getElementById("locationList");
  const search=document.getElementById("searchBox");
  if(list.style.display==="none"){
    list.style.display="block";
    search.style.display="block";
  } else {
    list.style.display="none";
    search.style.display="none";
  }
});

// --- Search ---
document.getElementById("searchBox").addEventListener("input",function(){
  const q=this.value.toLowerCase();
  const items=document.getElementsByClassName("location-item");
  for(let i=0;i<items.length;i++){
    items[i].style.display=items[i].innerText.toLowerCase().includes(q)?"":"none";
  }
});

// --- Geolocation & live update ---
function updatePosition(pos){
  const lat=pos.coords.latitude;
  const lon=pos.coords.longitude;
  currentLatLng=[lat,lon];
  userMarker.setLatLng([lat,lon]);
  if(followUser) map.panTo([lat,lon]); // keep zoom manual
  if(selectedLocation) showDistance(selectedLocation,currentLocationName);
}

if(navigator.geolocation){
  navigator.geolocation.watchPosition(updatePosition,function(err){console.warn(err);},{enableHighAccuracy:true});
}

document.getElementById("refreshLocation").addEventListener("click",function(){
  if(navigator.geolocation){
    followUser=true;
    navigator.geolocation.getCurrentPosition(updatePosition,{enableHighAccuracy:true});
  } else alert("Geolocation not available");
});
</script>
</body>
</html>
