<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NYC Map</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">

<style>
html,body{margin:0;padding:0;height:100%;width:100%;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;}
#map{height:100vh;width:100%;}

.version-box{
  position:absolute;top:10px;right:10px;
  background:white;padding:4px 8px;border-radius:10px;
  box-shadow:0 3px 10px rgba(0,0,0,0.15);
  font-size:12px;font-weight:600;z-index:1000;
}

#refreshLocation{
  position:absolute;top:40px;right:10px;
  background:#007bff;color:white;border:none;
  padding:4px 8px;border-radius:10px;
  font-size:12px;cursor:pointer;z-index:1000;
}

#location-container{
  position:absolute;top:70px;right:10px;
  width:200px;max-height:65vh;
  background:white;border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,0.15);
  display:flex;flex-direction:column;
  z-index:1000;font-size:14px;
}

#location-header{
  padding:10px;background:#f0f0f0;
  cursor:pointer;font-weight:bold;
  border-bottom:1px solid #ccc;
}

#searchBox{
  display:none;margin:5px auto;padding:5px;
  width:calc(100% - 20px);
  font-size:12px;border-radius:5px;border:1px solid #ccc;
}

#locationList{
  display:none;overflow-y:auto;flex:1;
}

.category-title{
  font-weight:bold;padding:6px 10px;
  background:#f9f9f9;border-bottom:1px solid #ddd;
}

.location-item{
  padding:6px 10px;cursor:pointer;
  border-bottom:1px solid #eee;
}
.location-item:hover{background:#eaeaea;}

#subwayToggle{
  display:none;padding:6px 10px;
  border-top:1px solid #ccc;font-size:12px;
}

#routeInfo{
  position:absolute;bottom:5px;left:50%;
  transform:translateX(-50%);
  background:white;padding:8px 12px;
  border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,0.15);
  font-size:12px;max-width:95%;
  line-height:1.2em;max-height:3.6em;
  overflow:hidden;white-space:pre-wrap;
}
</style>
</head>

<body>

<div id="map"></div>
<div class="version-box">NYC MAP 23/12/2025 v8.7</div>
<button id="refreshLocation">My Location</button>

<div id="location-container">
  <div id="location-header">Locations ▼</div>
  <input id="searchBox" placeholder="Search...">
  <div id="locationList"></div>
  <div id="subwayToggle">
    <label>
      <input type="checkbox" id="subwayCheckbox">
      Show subway stations
    </label>
  </div>
</div>

<div id="routeInfo">Select a location to see walking distance & time</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
/* =========================
   MAP + BASE SETUP
========================= */

const map = L.map("map").setView([40.7851,-73.9683],14);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{
  attribution:"© OpenStreetMap contributors"
}).addTo(map);

const icons={
  hotel:L.icon({iconUrl:"https://maps.google.com/mapfiles/ms/icons/red-dot.png",iconSize:[32,32]}),
  sight:L.icon({iconUrl:"https://maps.google.com/mapfiles/ms/icons/green-dot.png",iconSize:[32,32]}),
  food:L.icon({iconUrl:"https://maps.google.com/mapfiles/ms/icons/orange-dot.png",iconSize:[32,32]}),
  rooftop:L.icon({iconUrl:"https://maps.google.com/mapfiles/ms/icons/purple-dot.png",iconSize:[32,32]}),
  hidden:L.icon({iconUrl:"https://maps.google.com/mapfiles/ms/icons/yellow-dot.png",iconSize:[32,32]}),
  subway:L.icon({iconUrl:"https://maps.google.com/mapfiles/ms/icons/blue-dot.png",iconSize:[28,28]})
};

let followUser=false;
let selectedLocation=null;
let currentLatLng=null;

const userMarker=L.circleMarker([0,0],{
  radius:8,color:"#007bff",
  fillColor:"#007bff",fillOpacity:1
}).addTo(map);
  /* =========================
   LOCATIONS (ALL INCLUDED)
========================= */

const locations = {
  "The Hotel":{"The Lexington Hotel":[40.7561,-73.9725,"hotel"]},

  "Locations":{
    "Times Square":[40.7580,-73.9855,"sight"],
    "Central Park":[40.7851,-73.9683,"sight"],
    "Brooklyn Bridge":[40.7061,-73.9969,"sight"],
    "Empire State Building":[40.7484,-73.9857,"sight"],
    "Statue of Liberty":[40.6892,-74.0445,"sight"]
  },

  "Rooftop Bars":{
    "Le Bain":[40.7416,-74.0072,"rooftop"],
    "Overstory Rooftop Bar":[40.70647,-74.00771,"rooftop"]
  },

  "Hidden Bars":{
    "Please Don't Tell (PDT)":[40.72712,-73.98374,"hidden"],
    "Bathtub Gin":[40.74354,-74.00311,"hidden"],
    "The Back Room":[40.71873,-73.98691,"hidden"]
  },

  "Food & Drinks":{
    "Blue Bottle":[40.7410,-73.9887,"food"],
    "Tompkins Bagels":[40.7282,-73.9911,"food"]
  },

  "Subway Stations":{
    "Times Sq – 42 St":[40.75529,-73.987495,"subway"],
    "Grand Central":[40.7527,-73.9772,"subway"],
    "Union Square":[40.7359,-73.9911,"subway"]
  }
};

/* =========================
   MARKERS
========================= */

const markers={};
const subwayMarkers=[];

for(const cat in locations){
  for(const name in locations[cat]){
    const [lat,lng,type]=locations[cat][name];
    const m=L.marker([lat,lng],{icon:icons[type]}).bindPopup(name);
    if(type==="subway") subwayMarkers.push(m);
    else m.addTo(map);
    markers[name]=m;
  }
}

/* =========================
   LOCATION LIST
========================= */

const list=document.getElementById("locationList");

for(const cat in locations){
  const title=document.createElement("div");
  title.className="category-title";
  title.textContent=cat;
  list.appendChild(title);

  for(const name in locations[cat]){
    const item=document.createElement("div");
    item.className="location-item";
    item.textContent=name;
    item.onclick=()=>{
      followUser=false;
      selectedLocation=name;
      const [lat,lng]=locations[cat][name];
      map.setView([lat,lng],14);
      markers[name].openPopup();
      updateDistance(lat,lng,name);
      list.style.display="none";
      document.getElementById("searchBox").style.display="none";
      document.getElementById("subwayToggle").style.display="none";
    };
    list.appendChild(item);
  }
}

/* =========================
   SUBWAY TOGGLE
========================= */

document.getElementById("subwayCheckbox").onchange=e=>{
  subwayMarkers.forEach(m=>{
    e.target.checked ? m.addTo(map) : map.removeLayer(m);
  });
};

/* =========================
   UI TOGGLES
========================= */

document.getElementById("location-header").onclick=()=>{
  const open=list.style.display!=="block";
  list.style.display=open?"block":"none";
  document.getElementById("searchBox").style.display=open?"block":"none";
  document.getElementById("subwayToggle").style.display=open?"block":"none";
};

/* =========================
   GEOLOCATION
========================= */

function updateDistance(lat,lng,name){
  if(!currentLatLng) return;
  const R=6371e3;
  const dLat=(lat-currentLatLng[0])*Math.PI/180;
  const dLng=(lng-currentLatLng[1])*Math.PI/180;
  const a=Math.sin(dLat/2)**2+
    Math.cos(currentLatLng[0]*Math.PI/180)*
    Math.cos(lat*Math.PI/180)*
    Math.sin(dLng/2)**2;
  const d=R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
  document.getElementById("routeInfo").textContent=
    `${name}\nDistance ${(d/1000).toFixed(2)} km\nWalking ~${Math.ceil(d/84)} min`;
}

if(navigator.geolocation){
  navigator.geolocation.watchPosition(p=>{
    currentLatLng=[p.coords.latitude,p.coords.longitude];
    userMarker.setLatLng(currentLatLng);
    if(followUser){
      map.setView(currentLatLng,map.getZoom()+2);
    }
    if(selectedLocation){
      const loc=locations[Object.keys(locations)
        .find(c=>locations[c][selectedLocation])][selectedLocation];
      updateDistance(loc[0],loc[1],selectedLocation);
    }
  });
}

document.getElementById("refreshLocation").onclick=()=>{
  followUser=true;
  selectedLocation=null;
  document.getElementById("routeInfo").textContent=
    "Select a location to see walking distance & time";
};
</script>
</body>
</html>
