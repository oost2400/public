<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NYC Map</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
html, body {margin:0; padding:0; height:100%; width:100%; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;}
#map {height:100vh; width:100%;}
.version-box {position:absolute; top:10px; right:10px; background:white; padding:4px 8px; border-radius:10px; box-shadow:0 3px 10px rgba(0,0,0,0.15); font-weight:600; font-size:12px; z-index:1000;}
#refreshLocation {position:absolute; top:10px; right:140px; background:#007bff; color:white; border:none; padding:4px 8px; border-radius:10px; cursor:pointer; box-shadow:0 3px 10px rgba(0,0,0,0.15); font-size:12px; z-index:1000;}
#refreshLocation:hover{background:#0056b3;}
#location-container {position:absolute; top:50px; right:10px; width:240px; max-height:80vh; background:white; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.15); display:flex; flex-direction:column; z-index:1000; font-size:14px;}
#location-header {padding:10px; background:#f0f0f0; cursor:pointer; border-radius:12px 12px 0 0; font-weight:bold; border-bottom:1px solid #ccc;}
#searchBox {display:none; margin:0 10px 5px 10px; padding:5px 7px; border-radius:5px; border:1px solid #ccc; font-size:12px; outline:none; background:white; width:calc(100% - 20px);}
#locationList {overflow-y:auto; flex:1; padding:0; margin:0; display:none; border-top:1px solid #ccc;}
.category-title {font-weight:bold; padding:5px 10px; border-bottom:1px solid #ddd; background:#f9f9f9;}
.location-item {cursor:pointer; padding:5px 10px; border-bottom:1px solid #eee; transition: background 0.3s;}
.location-item:last-child {border-bottom:none;}
.location-item:hover {background-color:#eaeaea;}
#routeInfo {position:absolute; bottom:10px; left:50%; transform:translateX(-50%); background:white; padding:8px 12px; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.15); font-size:12px; z-index:1000; max-width:90%; line-height:1.2em; height:3.6em; overflow:hidden;}
@media (max-width:600px){
  #location-container{width:180px; top:60px;}
  #searchBox{width:calc(100% - 20px);}
  .version-box{font-size:11px; padding:3px 6px;}
  #refreshLocation{font-size:11px; padding:3px 6px; right:120px;}
}
</style>
</head>
<body>
<div id="map"></div>
<div class="version-box" id="versionBox"></div>
<button id="refreshLocation">My Location</button>

<div id="location-container">
  <div id="location-header">Locations ▼</div>
  <input type="text" id="searchBox" placeholder="Search..." />
  <div id="locationList"></div>
</div>

<div id="routeInfo">Select a location to see walking distance and time</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// --- Version ---
var mapDate = "07/11/25";
var mapVersion = 7.4;
document.getElementById("versionBox").innerText = "NYC Map " + mapDate + " (v" + mapVersion + ")";

// --- Map init ---
var map = L.map('map').setView([40.7851,-73.9683],14);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution:'&copy; OpenStreetMap contributors' }).addTo(map);

// --- Icons ---
var icons = {
  hotel: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/red-dot.png', iconSize:[32,32]}),
  sight: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/green-dot.png', iconSize:[32,32]}),
  food: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/orange-dot.png', iconSize:[32,32]}),
  rooftop: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/purple-dot.png', iconSize:[32,32]}),
  subway: L.icon({iconUrl:'https://maps.google.com/mapfiles/ms/icons/blue-dot.png', iconSize:[28,28]})
};

// --- User location as round circle ---
var userMarker = L.circleMarker([0,0], {radius:10, color:'#007bff', fillColor:'#007bff', fillOpacity:0.8}).addTo(map);
var currentLatLng = [null,null];

// --- Locations ---
var locations = {
  "Locations":{
    "The Lexington Hotel":[40.7561,-73.9725,"hotel"],
    "Times Square":[40.7580,-73.9855,"sight"],
    "Central Park":[40.7851,-73.9683,"sight"],
    "Union Square":[40.7359,-73.9911,"sight"],
    "Bryant Park":[40.7536,-73.9832,"sight"],
    "Rockefeller Center":[40.7587,-73.9787,"sight"],
    "Highline":[40.7480,-74.0048,"sight"],
    "Chelsea Market":[40.7424,-74.0060,"sight"]
  },
  "Food & Drinks":{},
  "Rooftop Bars":{},
  "Subway Stations":{}
};

// --- Markers ---
var markers = {};
for(let cat in locations){
  for(let key in locations[cat]){
    let loc = locations[cat][key];
    let marker = L.marker([loc[0],loc[1]], {icon: icons[loc[2]]});
    if(loc[2]!=="subway") marker.addTo(map);
    marker.bindPopup(key);
    marker.on('click', function(){ showDistance([loc[0],loc[1]],key); });
    markers[key]=marker;
  }
}

// --- Distance ---
function showDistance(latlng,name){
  if(!currentLatLng[0]) return;
  var R = 6371e3;
  var φ1 = currentLatLng[0]*Math.PI/180;
  var φ2 = latlng[0]*Math.PI/180;
  var Δφ = (latlng[0]-currentLatLng[0])*Math.PI/180;
  var Δλ = (latlng[1]-currentLatLng[1])*Math.PI/180;
  var a = Math.sin(Δφ/2)**2 + Math.cos(φ1)*Math.cos(φ2)*Math.sin(Δλ/2)**2;
  var c = 2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
  var d = R*c;
  var walkSpeed=1.4;
  var timeMin=Math.ceil(d/walkSpeed/60);
  var distKm=(d/1000).toFixed(2);
  document.getElementById("routeInfo").innerText=`${name}\nDistance: ${distKm} km\nEstimated walking time: ${timeMin} min`;
}

// --- Populate list ---
var locationList=document.getElementById("locationList");
for(let cat in locations){
  let catTitle=document.createElement("div");
  catTitle.className="category-title";
  catTitle.innerText=cat;
  locationList.appendChild(catTitle);
  for(let key in locations[cat]){
    let loc=locations[cat][key];
    let marker=markers[key];
    let div=document.createElement("div");
    div.className="location-item";
    div.innerText=key;
    div.onclick=function(){ marker.openPopup(); map.setView([loc[0],loc[1]],15); showDistance([loc[0],loc[1]],key); };
    if(cat==="Subway Stations") div.style.display="none";
    locationList.appendChild(div);
  }
}

// --- Collapsible ---
document.getElementById("location-header").addEventListener("click",function(){
  let list=document.getElementById("locationList");
  let search=document.getElementById("searchBox");
  if(list.style.display==="none"){
    list.style.display="block"; search.style.display="block"; 
  } else { list.style.display="none"; search.style.display="none"; }
});

// --- Search ---
document.getElementById("searchBox").addEventListener("input",function(){
  let filter=this.value.toLowerCase();
  let items=document.getElementsByClassName("location-item");
  for(let i=0;i<items.length;i++){
    items[i].style.display=items[i].innerText.toLowerCase().includes(filter)?"":"none";
  }
});

// --- Get location ---
function updatePosition(pos){
  let lat=pos.coords.latitude;
  let lon=pos.coords.longitude;
  currentLatLng=[lat,lon];
  userMarker.setLatLng([lat,lon]);
  map.flyTo([lat,lon],15,{duration:1.0});
}

if(navigator.geolocation){
  navigator.geolocation.watchPosition(updatePosition,function(err){console.warn(err);},{enableHighAccuracy:true});
}

document.getElementById("refreshLocation").addEventListener("click",function(){
  navigator.geolocation.getCurrentPosition(updatePosition,{enableHighAccuracy:true});
});
</script>
</body>
</html>
